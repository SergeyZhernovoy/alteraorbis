- redo AvoidOthers(). Full crunch stops break the game.
x not showing bolt impacts
- texture bleeding in voxel renderer
- flower colors (too saturated flowers)
- use arrays to track components and component update time.
  switch to calling the components vs. calling the chit. coherence is good!
  each component stores its location in the array so it can null itself on remove
- change shield to have cooldown then charge-up (rather than cooldown then reset)
- rings deflect bolts
- redo AI utility to be based on a set of curves
x health is awkward: keeps copy of HP (oops). move hp to health component? (TotalHP() on item?)
x integers for discrete values (hp, gold)
- remove UI button for track - only teleport (or at least hide)
- fix / disable right mouse behavior
- UI on minimap. Target, show highlight of domain.
- consider removing chit listeners
- unify rockgen and worldgen. frustrating they are separate steps.
- rethink spawning. spawn based on need? what's around?
- need to "ding" on level up
- add rez-in animation
- show rock damage
x support melee attack on rocks
- Move after shooting target, continue to hit after destroying rock. need more awareness
  of the overall AI state.
- Melee should rotate to target (both rock and chit)
- How does Ice and magma interact?

- game
	- Gold
		x drop gold
		x player picks up gold
		x ai picks up gold
		x reserve to distribute gold to denizens
		x gold & crystal to volcanos
		x core vs spawn points
		x critters level up
		x remove rock ray
		x fix crystal types
		x bind to core
		x workers remove rock
		x workers add ice
		- workers build kiosk
		- visitors warp in, travel warp out
		- visitors visit interesting buildings
		- visitors create energy, buildings consume energy
		- leave core
	- Art
		- item screen
		- proper animation system
		- rain, general de-saturation
		- aging of stone
	- Loot
		- drop items
		- pickup items
		- weapon toggle / selection
		x level up
		- character screeen
		x disable buttons on main ui when no game saved
	- Fauna 2
		- teams. friend-enemy-neutral logic.
		- monster ecology
		- visitors
		- inventory screen
	- Building
		- construction
		- economics
		- domain building
	- AI
		- other cores doing the same

- combat test scene	
	x connect item to procedural rendering of melee weapon
	- weapon types
	- animation speed isn't correct
	- gunrun to walk not synchronized correctly
	- revisit accuracy comuptation. what scales with distance? area? volume? radius?
	- melee attack goes back to reference position between hits

	- AI (task AI)
		- removing unit "clumping" (3yr old soccer team). Basic formation?
		- establish friend vs. enemy
		- basic states
		- CA to handle friends and enemies
	- UI
		x set up different battles
		- battle results

	x serialization

- render-through for player behind objects
- add target portrait
- review all atlases for texture mem usage
- particles aren't additive correctly
- put metadata in model (authoring  time)
- credits scene
- remove normalization in shader
- print uniform count for shaders
- animition aware hit testing
- bounds need to be adjusted to account for animation
- record perf max/min. surprisingly hard.
- memory pool everything in the chit/component system
- analyze/optimize what causes component update: DoTick(), etc. Likely many DoTicks() getting called that aren't needed. (especially rendering...)
- add rez effect for item switch?
- animation generation
- volcanos: taper at the end
- zoom way out
- peaks news

** Art **
- Cyclops
    - http://grinninglizard.com/altera/forum/index.php?topic=8.msg172#msg172
	- replace balrog
	- model.
		- double size of arms
	- animation
	- variant: fire
	- variant: shock
	- variant: blaster
- Human Male
	- model
	- texture (procedural)
	- animation
- Human Female v2
	- model
	- texture (procedural)
	- animation
- Goblin Half Man
	- http://grinninglizard.com/altera/forum/index.php?topic=8.msg186#msg186
	- model
	- animation
- Mantis Man
	- concept
	- model 
	- animation
- Mantis
	- concept
	- model 
	- animation
- Flora
	- concept
	- models

- wilder, more digital face colors
- filter face colors to matching effect
- more natural skin tones

---------- Defer ----------
d switch to ImageMagick for texture scaling
- animation sync is generally flakey - lock to vsync? Not aware of any way to solve this.
d when loading during grid travel, you sometimes back up. (Regen path on load; chooses wrong starting point. annoying to fix).
d GT bug: reconsider auto-mip. review texture upload. 
d bone filter in reverse. more efficient and useful.
- use optimizer to pre-process shaders
- bolt: glow around white core? end caps?
- particles that aren't quads (beziers)
- pack animation bone info into shaders
- effects
	- environment: water contains fire, spreads shock
	- down chain: a fire creature should catch things on fire that it holds

V2 ideas:
- content popups when you are near a kiosk (email from GT)
- "populous style" rocks. diagonals, points.
- level up grid and special skills

----------- FIXED -------------

x sector-herding still getting stuck. Go back to random re-herd?
	x guarentee path to core
	x clear space around core
x remove temporary arbitrary AI limit in corescript
x add portals
x more critters
x space around ports
x sector herding: more aggressive? wider range?
x arrays in spatial query much, much too dangerous. Support CArray?
x explosion is in the wrong direction. Units walk through explosions?? (Balrog vs. Human.)
x touching buttons clears tracking and can leave in weird state where camera doesn't track player
x update the "procedural rendering" wiki
x does fire affect plants??
x cameras only self-delete if they reach destination; should do better. Probably
  should only be one camera in existence. (BlueSmoke, NavTest2)
x refactor code - if needed? - in AIComponent (the fixmes)
x faces are using too much memory, or too low res...hmmm. Should really use texture packer and store a lookup.
x handle device loss in live preview
x rationalize hardpoints: array index or flag? lookt at RenderComponent
x mantis trigger broken
x particles should use palette. <color palette="2 3 1.0"/> possibly
x shadows should be part of space-tree bounds
x resize in game screen wipes out textures
x GridMoveComponent: deleteWhenDone in uninitialized. Remove API altogether? Or at least default true.
x lock camera (no slop) when in grid mode? Hides vsync problem
x need free camera mode
x control key is terrible...sometimes.
x remove 'inUse' flag
x Intermission: regions
	x generate regions
	x generate roads
	x burn to map
	x update zones
	x update pathfinder. limit to sectors.
	x limit AI
		x detection and awareness to sector bounds
	x fix cores to work with sectors
	x limit bolts / collisions
	x grid motion
	x refactor gamescene - map and mini-map clicking should use the same code
	x pather per sector
	x fix inUse. wow. fix inUse. Then only isBlocked will be an awful hack.
		Note: fixed. Switched both inUse and isBlocked to callback. May require
		future optimazation.
	x simpler shaders
	x new start location
	x make sure cores are in correct place
	x textures
		x grid
		x port. bake lighting.
	x herding
		x fix health
		x herding notification
		x herding doesn't check for valid dest sector
		x try herding (at 100%) on path fail + lots of friends. hopefully
			solves super-crowing.
		x clear news tracking
	x test serialization of grid move
	x move health/ammo/shield to face pic
	x no flora on ports. or buildings, etc.
	x improved Uniform() RNG
	x fix camera dragging bug
	x fix AI to not charge into melee if ranged is a better idea
	x load existing world
	x test fast mode
	x overnight test
x Fauna 1
	x motion around cores
	x monsters to fight
	x battles!
	x control of target
	x target highlight
x mantis tribes - whos fighting who?
x awareness range is a little high. dobule the awareness (?) should forget even a focused target.
x check that shields and damage absorbing is working correctly. something seems wrong with shields - recharge?
x shield glow broken. so hard to tell not sure it's worth doing.
x The item / weapon system really isn't working, and it's complex. Needs coordination between
  renderer, item, and weapon system to know the current weapon. (!!) Would rather have a one
  weapon system (where the current weapon can be switched out.) See ComuteLeadingShot()
x Flora
	x plants
		x growth, spread
		x rotation
		x saturation to hp
	x fix the stupid camera
	x weather
	x player recreation
	x avatar face display
	x debug UI toggle
	x new assets from Shroom
	x change main face
	x long test
	x date on main screen
	x move down buttons
x Land and Water
	x generate a random world
	x save / load
		x 'shelf'
		x save, load, cycle buttons
		x optimize cycle time (fast png write?): not much to do here, without swapping out the encoder
		x save bolts
	x walk around it
		x where is world origin? mini-map origin? save/load origin? line all that up
		x mark location on mini-map
- Rock and Stream
	x rock formation
		x need more local height variation
	x cave
	x pools
	x waterfall
	x lava gen
	x fast-step world sim
x need different particle effect for melee impact
x run & gun and explosive weapons is probably a bad idea. But shoot for explosive should
  be much more likely.
x chits should have "update time" not boolean flag
x volcano delayed on save/load cycle (size getting set to zero?)
x water creation seems deferred to save/load cycle. SetRock() not quite correct?
x assert when clicking on location player can't go
x crash on exit
x really must fix the shadow popping bug. and bounds calc for that.
x need teleport mode
x save / load rocks
x get stuck when teleporting
x drawcalls debugging for all scenes
x procedural rendering
	x more glasses colors
	x fix glasses: they can be tightly packed, and occurance done in script
	d procedural: the shading should "go through" so that a shadow on layer 3 is renderered below colors are layer0
	x move texture coordinate calc to script
	x static scene showing item combinations
	x emissive support
	x item bone/part support
	x re-organize the palette?
	x color variation 
	x color variation for live mode
x battle scene
	x ranged weapons
		x accuracy
		x effect
		X reload time 'reload'
		X time per shot 'cooldown'
		X rounds in clip
	x ranged accuracy / weapon types / ItemStat data
	x add de-rez
	x unique look for units so teams can be distinguished
	x buttons to select scenario, load items
	x shock should affect shields, fire should diminish even when flammable, and shockable should diminish
	x restore micropather cache
	X error in ray-cast: detecting a 'tree' where it shouldn't (near the head of the prime)
	x adjust particles to have "impact" effect
	X don't check for item destroyed/death on DAMAGE msg - needs to be moved to tick.
	x bolts are hitting own team	
	X eval: kinetic damage of held weapons shouldn't be multiplied with mass (added)
	X properly hook up items and such, so that items, health, all be driven correctly
	X fix particle def to return a default - the pointer is dangerous
	X DebugDraw is getting used for release drawing - fine in most (all?) cases. But clean up.
	X hesitation when near melee target (probably squatted destination code kicking in)
	  (possibly shader kicking in: never seen it happen twice). Not actually fixed - may need
	  GL optimizer - but definitely the shader kicking in
	X weapons
		X relative positioning (implemented, broken again)
		X weapon definition - item question: how is a chit a weapon?
		X item d	X why does balrog just stand around not attacking mantis
	X ...and yet the AOE of melee seems huge. clean all that up.
	X human runs up to dummy, circles around it
	X data driven item creation
	X leaving guy standing after battle
	X debugging info for chit ticks
	X back in the tick system: the "need tick" vs. "no tick" changes. Note for 
	  example whether an item has effects applied. Or the kind of animation. Don't
	  want to tick granite chunks when they don't need it. Key concerns: 
	  Rendering, Item that changes tick status
	X melee attack standing too close 
	X avoiding while pathing doesn't look quite correct
	X need left/right team, not species based
	X animation/lack of making me crazy. What plan?
	X particle effect for melee strike not "connected" to character
	X item definition: one big wad of data? handle "inherited items"?
	X use space tree query for impacted items. Everything that has a spatial component
	  is now in the table, so this should be "fixed".
	X need to check rotation in the path component
	X load in the correct lighting
	X put in license header
	X push to altera site
	X balrog fire attack
	X visual debugging: line drawing. check bolt impacts.
	X impact (light/heavy)
	X heavy weapons should do knockback, not just amount of damage/explosion
	X change bolt color
	X item: support speed, pass on to bolts
	X optimize start time
	X change effect strategy - are all effects just flags?
	X shields, general bonus/cost/damage propegation
	X knife -> ring
	X bolts don't hit own team but explosions do. decided this was a good thing.

x bolts
	d range
	x effect strength
	x damage (defined)
	x speed
	x compute color
x effects
	x effects spread to nearby when they should
	x flaming sword
	x flaming sword should catch things on fire when it hits
X Need BSearch and QSort
X the render::Item class doesn't make much sense any more. should probaly just be a reference to the Model
X what is going on with engine state when there are 2 textures?
X RenderState search is reversed
X clean up shields
X move EngineShaders local
X one item array
X extend rendering test to animation
X output drawcalls per state
X clean up instance rendering
X particle test scene
	X alpha processing for additive blending
	D particle groups (ex: fire)
X ECR: proper rotation support
X feature: Animation
	X figure out animation needs (standing, walking, sidestep, shooting, etc.)
	X define skeletal animation export
	X modify shaders
	X blend animations
X rotation: in spatial component? Matrix or Quat?
X NavTest-1 is broken. More container fallout. And once again an existing bug
  revealed by tighter container code.
X container to support copy semantics
X remove particle params not needed for world
X move lighting loading from render test scene to engine
X Animation
	X support for instancing
	X particle tracking of meta-data
	X item tracking of meta-data
	X timing of impact / shoot / hit events
	X need impact animation (light & heavy?)
	X remove rotation twist for ortho
	X animation rate
	X cross fading
	X revisit all scenes, add animation
		X Where does animation fit in? walk, gun-run, impact-, melee
		X Render: query walking/standing from Move component?
		X The AnimatedRenderComponent is annoying - move code to RenderComponent
X blur: switch to "down blit" approach, optionally
X Blue Smoke Map Test
	X full size (1024x1024), 2000 units
		X faster avoidance
			X separate avoid queries from spatial queries
			X hash scheme needs work
		X faster Model::Update
			X don't re-link if possible on update. model probably is in the same node.
			X faster AABB calc? are we using normals? should we?
			D don't update things well outside the rendering area? switch to local rendering?
			D re-tune tree size
			X switch to sphere testing. avoid flushing the AABB entirely
	X need to get to 2000 faster
	X entity debug system: point at chit, get component info
	X some units get stuck and never move (pathing fails & doesn't re-start?)
	X fix camera code
	X need a mini-map
	X filling of path cache: correct? why does the cache keep incrementing? what should the game do when it's full?
	X show region code
	D profiler max-ing out
	D much better test bitmap
	X 2 continents
	X bridge

X pathing
	X record path miss in cache
	X test cache miss 
	X print cache use
X navigation scene
	X map with pathing
	X chits & components
	X debugging components for showing collision/vectors
	X ground flocking motion
	X different size unitsX PathMoveComponent: can get blocked if 'dest' is being squatted by a unit.
X chits, components
X rotation: in spatial component? Matrix or Quat?
X move particle system to engine
X particle textures "popping in" (fix: was incorrectly passing 3 components in the attributes)
x instance scene
	x shadows
	x glow
	x hemispherical lighting
X desktop (art):
	X light model
	X test models
X streamline render atom creation
X work out atom usage
X create dialog scene
	X standard layout
	X automatic callback
	X drag / drop
X move Engine to Scene / move engine to correct place
X draw dude on map
	X with shader
	X clean up opengl = 2
X convert to tinyxml2


77.5k/frame - using 3 cubes for rocks.
66.1k/frame - using 1 cube for rock.

Baseline
#define TEXTURE0 1
#define TEXTURE0_ALPHA_ONLY 0
#define TEXTURE0_TRANSFORM 0
#define TEXTURE1 0
#define COLOR_PARAM 0
#define COLORS 0
#define COLOR_MULTIPLIER 0
#define INSTANCE 1
#define PREMULT 0
#define EMISSIVE 0
#define EMISSIVE_EXCLUSIVE 0
#define BONE_FILTER 0
#define BONES 0
#define PARAM 0
#define LIGHTING_DIFFUSE 1
#define EL_MAX_INSTANCE 16
#define EL_MAX_BONES 12

CreateProgram flags=7169 665 msec total=2016
CreateProgram flags=7169 681 msec total=1901
CreateProgram flags=7169 685 msec total=1987

Remove shader info log query:
CreateProgram flags=7169 682 msec total=2130	// good! does nothing

Use one file instead of separate header and source:
CreateProgram flags=7169 680 msec total=2067	// does nothing, but more surprising

Remove the 2 constants.
CreateProgram flags=7169 672 msec total=1917	// still does nothing

Trim down the program to minimal compilation.
CreateProgram flags=7169 690 msec total=2239	// this is just weird
CreateProgram flags=7169 675 msec total=2009
CreateProgram flags=7169 691 msec total=2079

Updated Driver. *sigh*
CreateProgram flags=7169 779 msec total=2086

Caching, first run:
CreateProgram flags=7169 803 msec total=2393	// write to disk included
CreateProgram flags=7169 864 msec total=1755	// AACCK stupid intel driver doesn't support extension

Desktop, caching on:
CreateProgram flags=7169 2 msec total=20
CreateProgram flags=7169 3 msec total=25
Desktop, caching off:
CreateProgram flags=7169 72 msec total=873	// Huge success! If only it worked on laptop.
CreateProgram flags=7169 89 msec total=772	// Pull out color mult

But on the desktop, 40X (yes 40) faster:

Save file (flora)
11.5MB	baseline
9.4		initial cleanup of output
7.7		default values for color and vectors

Save/load time (debug)
Sim::Load 31.6 MClocks
Sim::Save 13.4 MClocks

Sim::SaveXarc 10.1 MClocks, 17.9 MB
			   9.2 MClocks

New baseline:
	SaveXML		956k, 0.7 MClocks
	SaveXarc	960k, 0.5 MClocks
				917k, 0.5 MClocks	zero support
				841k				default in GameItem
				711,  0.40			default in Model
			Squisher
				637k  1.10 MClocks	Wow - super slow down. ratio=55% which is great. Disabling
									for now, may turn back on. May be able to optimize, but
									not sure what is slow. (Memory access? Bit manipulation?)
				XML   0.75 MClocks
				745,  0.60 MClocks	not sure why it went up. But okay.
end of battle:
15 baseline
23 switched over to a better component type system
25 fixed over-computing zones. path cache still not working.
33...because I had frame limiting on. Not sure what fixed what.


StreamWriter string	=1832747 
			 data   = 860574
			 int	= 279856 
			 float	= 188752 
			 double	=  35784 
			 byte   =      0 
			 attrib =   2564 
